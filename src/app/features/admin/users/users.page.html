<div class="mx-auto max-w-[1400px] px-6 py-6">
  <!-- Encabezado -->
  <h1 class="text-3xl font-semibold">Usuarios</h1>
  <p class="muted mb-4">Gestiona los usuarios del sistema</p>

  <!-- Filtros: una fila debajo del encabezado -->
  <div class="grid grid-cols-1 md:grid-cols-12 gap-3 mb-5 items-center">
    <!-- Buscador (largo) -->
    <div class="md:col-span-7">
      <label class="sr-only" for="users-search">Buscar</label>
      <div class="relative">
        <input
            id="users-search"
            class="w-full rounded-lg border border-zinc-300 bg-white px-4 py-2 pr-10 outline-none focus:border-zinc-500"
            [ngModel]="_searchRaw()"
            (ngModelChange)="onSearchChange($event)"
            placeholder="Buscar por nombre, apellido o correo"
            />
        <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400">
          üîç
        </span>
      </div>
    </div>

    <!-- Rol -->
    <div class="md:col-span-3">
      <label class="sr-only" for="users-role">Rol</label>
      <select id="users-role"
              class="w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 outline-none focus:border-zinc-500"
              [ngModel]="roleFilter()"
              (ngModelChange)="onRoleChange($event)">
        <option value="ALL">Todos los roles</option>
        <option value="ADMIN">ADMIN</option>
        <option value="GERENTE">GERENTE</option>
        <option value="DIRECTOR">DIRECTOR</option>
      </select>
    </div>

    <!-- Bot√≥n nuevo -->
    <div class="md:col-span-2">
      <button class="w-full md:w-auto rounded-lg bg-black px-4 py-2 text-white hover:opacity-90"
              (click)="openCreate()">
        + Nuevo usuario
      </button>
    </div>
  </div>

  <!-- Tabla -->
  <div class="rounded-lg border border-zinc-200 bg-white overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-zinc-50">
        <tr class="text-left">
          <th class="p-3">Nombre</th>
          <th class="p-3">Apellido</th>
          <th class="p-3">Correo</th>
          <th class="p-3">Rol</th>
          <th class="p-3 w-32"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of filtered()" class="border-t">
          <td class="p-3">{{ u.name }}</td>
          <td class="p-3">{{ u.lastName }}</td>
          <td class="p-3">{{ u.email }}</td>
          <td class="p-3">
            <span class="inline-block rounded-full bg-zinc-100 px-2 py-1 text-[11px] font-medium text-zinc-700">
              {{ u.role }}
            </span>
          </td>
          <td class="p-3 text-right">
            <button class="text-blue-600 hover:underline mr-2" (click)="openEdit(u)">Editar</button>
            <button class="text-red-600 hover:underline" (click)="remove(u)">Eliminar</button>
          </td>
        </tr>

        <tr *ngIf="!loading() && filtered().length === 0">
          <td class="p-6 text-center text-zinc-500" colspan="5">Sin resultados</td>
        </tr>
        <tr *ngIf="loading()">
          <td class="p-6 text-center text-zinc-500" colspan="5">Cargando‚Ä¶</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer de resultados -->
  <div class="mt-3 text-sm text-zinc-600">
    Mostrando {{ filtered().length }} de {{ users().length }}
  </div>

  <!-- Modal: crear/editar (sin cambios) -->
  <div *ngIf="showForm()" class="fixed inset-0 bg-black/40 grid place-items-center p-4">
    <div class="bg-white w-full max-w-md rounded-xl p-6 shadow-xl">
      <h2 class="text-xl font-semibold mb-4">
        {{ editingId() ? 'Editar usuario' : 'Nuevo usuario' }}
      </h2>

      <form (ngSubmit)="submit()" class="space-y-3">
        <div>
          <label class="block text-xs mb-1">Nombre</label>
          <input class="input w-full" [(ngModel)]="f.name" name="name" required>
        </div>
        <div>
          <label class="block text-xs mb-1">Apellido</label>
          <input class="input w-full" [(ngModel)]="f.lastName" name="lastName" required>
        </div>
        <div>
          <label class="block text-xs mb-1">Correo</label>
          <input class="input w-full" type="email" [(ngModel)]="f.email" name="email" required>
        </div>
        <div>
          <label class="block text-xs mb-1">Tel√©fono (opcional)</label>
          <input class="input w-full" [(ngModel)]="f.phone" name="phone">
        </div>

        <div>
          <label class="block text-xs mb-1">
            Contrase√±a {{ editingId() ? '(opcional al editar)' : '' }}
          </label>
          <input class="input w-full" type="password" [(ngModel)]="f.password" name="password" [required]="!editingId()">
        </div>

        <div>
          <label class="block text-xs mb-1">Rol</label>
          <select class="input w-full" [(ngModel)]="f.roleId" name="roleId" required>
            <option [ngValue]="1">ADMIN</option>
            <option [ngValue]="2">GERENTE</option>
            <option [ngValue]="3">DIRECTOR</option>
          </select>
        </div>

        <div class="flex justify-end gap-2 pt-2">
          <button type="button" class="btn-outline" (click)="cancelForm()">Cancelar</button>
          <button class="btn" [disabled]="loading()">
            {{ loading() ? 'Guardando‚Ä¶' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
