<h3 class="section-title">Información del cliente</h3>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

  <!-- CLIENTE -->
  <div>
    <label class="form-label">Cliente *</label>

    <div class="flex items-center gap-2">
      <ui-combobox class="flex-1" [items]="clientesItems" placeholder="Seleccione cliente..."
        [(value)]="clienteIdSeleccionado" (valueChange)="onClienteChange($event)">
      </ui-combobox>

      <button
        class="btn-icon text-[--brand] border border-[--brand] rounded-full h-10 w-10 flex items-center justify-center"
        (click)="modalCliente.show()">
        +
      </button>
    </div>
  </div>

  <!-- CONTACTO -->
  <div>
    <label class="form-label">Contacto *</label>

    <div class="flex items-center gap-2">
      <ui-combobox class="flex-1" [items]="contactosItems" placeholder="Seleccione contacto..."
        [(value)]="contactoSeleccionado" (valueChange)="patchContacto()" [disabled]="contactosItems.length === 0">
      </ui-combobox>

      <button
        class="btn-icon text-[--brand] border border-[--brand] rounded-full h-10 w-10 flex items-center justify-center"
        (click)="modalContacto.show()" [disabled]="!clienteIdSeleccionado">
        +
      </button>
    </div>
  </div>

  <!-- PROYECTO -->
  <div>
    <label class="form-label">Proyecto *</label>

    <div class="flex items-center gap-2">
      <ui-combobox class="flex-1" [items]="proyectosItems" placeholder="Seleccione proyecto..."
        [(value)]="proyectoSeleccionado" (valueChange)="patchProyecto()" [disabled]="proyectosItems.length === 0">
      </ui-combobox>

      <button
        class="btn-icon text-[--brand] border border-[--brand] rounded-full h-10 w-10 flex items-center justify-center"
        (click)="modalProyecto.show()" [disabled]="!clienteIdSeleccionado">
        +
      </button>
    </div>
  </div>

</div>


<h3 class="section-title mt-10">Datos de la cotización</h3>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">

  <!-- TÍTULO -->
  <div>
    <label class="form-label">Título *</label>
    <input class="form-input" type="text" [(ngModel)]="d.name" (ngModelChange)="patch({ name: d.name })"
      placeholder="Ingresa un nombre para la cotización" />
  </div>

  <!-- COBERTURA -->
  <div>
    <label class="form-label">Cobertura *</label>
    <ui-select [items]="coberturaItems" [(value)]="d.cobertura" (valueChange)="onCoberturaChange($event)"
      placeholder="Seleccione cobertura..."></ui-select>
  </div>

  <!-- TOTAL ENTREVISTAS -->
  <div>
    <label class="form-label">Total entrevistas *</label>
    <input class="form-input" type="number" min="0" [ngModel]="d.totalEntrevistas"
      (ngModelChange)="patch({ totalEntrevistas: $event })" />
  </div>

  <!-- DURACIÓN CUESTIONARIO -->
  <div>
    <label class="form-label">Duración cuestionario (min) *</label>
    <input class="form-input" type="number" min="1" [ngModel]="d.duracionCuestionarioMin"
      (ngModelChange)="patch({ duracionCuestionarioMin: $event })" />
  </div>

  <!-- METODOLOGÍA -->
  <div>
    <label class="form-label">Metodología *</label>
    <ui-select [items]="metodologiaItems" [(value)]="d.metodologia" (valueChange)="onMetodologiaChange($event)"
      placeholder="Seleccione metodología..."></ui-select>
  </div>

  <!-- PENETRACIÓN -->
  <div>
    <label class="form-label">Penetración de la categoría *</label>

    <ui-select [items]="penetracionItems" [(value)]="penetracionSeleccionada"
      (valueChange)="onPenetracionChange($event)" placeholder="Seleccione penetración..."></ui-select>

    <!-- INPUT PERSONALIZADO -->
    <div *ngIf="penetracionSeleccionada === 'custom'" class="mt-2">
      <input class="form-input" type="number" placeholder="Ingrese porcentaje (1-100)" min="1" max="100"
        [ngModel]="d.penetracionCategoria ? d.penetracionCategoria * 100 : null"
        (ngModelChange)="patch({ penetracionCategoria: $event ? $event / 100 : null })" />
    </div>
  </div>

</div>


<modal-crear-cliente #modalCliente (creado)="crearCliente($event)">
</modal-crear-cliente>

<modal-crear-contacto #modalContacto [clienteId]="clienteIdSeleccionado ?? 0" (creado)="crearContacto($event)">
</modal-crear-contacto>

<modal-crear-proyecto #modalProyecto [clienteId]="clienteIdSeleccionado ?? 0" [contactoId]="contactoSeleccionado"
  (creado)="crearProyecto($event)">
</modal-crear-proyecto>