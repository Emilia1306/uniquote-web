<div class="mx-auto max-w-[1400px] px-6 py-6">

  <!-- Encabezado -->
  <div class="mb-4">
    <h1 class="text-3xl font-semibold text-[color:var(--accent-600)]">
      {{ cliente()?.empresa || 'Cliente' }}
    </h1>
    <p class="muted">{{ cliente()?.razonSocial || 'Raz√≥n social' }}</p>
  </div>

  <!-- Alert de error -->
  <div *ngIf="error()" class="mb-4 rounded border border-red-200 bg-red-50 p-3 text-red-700">
    {{ error() }}
  </div>

  <!-- Toolbar -->
  <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_auto] gap-3 md:items-center mb-6">
    <!-- Buscador -->
    <div class="relative">
      <input
        class="w-full rounded-lg border border-zinc-300 bg-white px-4 py-2 pr-10 outline-none focus:border-zinc-500"
        type="text"
        [ngModel]="qRaw()"
        (ngModelChange)="setQRaw($event)"
        placeholder="Buscar por nombre, email o tel√©fono"
      />
      <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 opacity-60">üîç</span>
    </div>

    <!-- Toggle vista √∫nico -->
    <button
      type="button"
      class="btn-outline md:w-auto w-full"
      (click)="setView(view()==='cards' ? 'list' : 'cards')">
      {{ view()==='cards' ? 'Ver lista' : 'Ver cards' }}
    </button>

    <!-- Nuevo contacto -->
    <div class="text-right">
      <button class="btn bg-[var(--accent-600)] text-white hover:opacity-90 px-4 py-2 text-sm" (click)="openCreate()">+ Nuevo contacto</button>
    </div>
  </div>

  <!-- Vista CARDS -->
  <div *ngIf="view()==='cards'">
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5">
      <div
        *ngFor="let c of filtered()"
        class="rounded-xl border border-zinc-200 bg-white p-5 shadow-sm transition hover:shadow-md"
      >
        <!-- T√≠tulo -->
        <div class="mb-3">
          <div class="text-lg font-semibold">{{ c.nombre }}</div>
          <div class="mt-1 h-px bg-zinc-200"></div>
        </div>

        <!-- Datos -->
        <ul class="space-y-2 text-sm text-zinc-700 mb-4">
          <li class="flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-zinc-400"></span>
            <span class="text-zinc-500">{{ c.email }}</span>
          </li>
          <li class="flex items-center gap-2">
            <span class="inline-block h-2 w-2 rounded-full bg-zinc-400"></span>
            <span class="text-zinc-500">{{ c.telefono }}</span>
          </li>
        </ul>

        <!-- M√©tricas (placeholder opcional) -->
        <div class="flex items-center justify-center gap-10 mb-4">
          <div class="text-center">
            <div class="text-base font-semibold text-[color:var(--accent-600)]">‚Äî</div>
            <div class="text-xs text-zinc-500">Cotizaciones</div>
          </div>
          <div class="text-center">
            <div class="text-base font-semibold text-green-600">‚Äî%</div>
            <div class="text-xs text-zinc-500">Aprobaciones</div>
          </div>
        </div>

        <!-- Acciones -->
        <div class="flex justify-between items-center">
          <div class="flex gap-2">
            <button class="btn-outline" (click)="openEdit(c)">Editar</button>
            <button class="btn-danger" (click)="remove(c)">Eliminar</button>
          </div>
          <a class="btn bg-[var(--accent-600)] text-white hover:opacity-90 px-4 py-2 text-sm" [routerLink]="['.']">Ver historial</a>
        </div>
      </div>

      <!-- Estados -->
      <div *ngIf="!loading() && filtered().length === 0" class="col-span-full">
        <div class="rounded-lg border border-zinc-200 bg-white p-8 text-center text-zinc-500">
          Sin resultados
        </div>
      </div>
      <div *ngIf="loading()" class="col-span-full">
        <div class="rounded-lg border border-zinc-200 bg-white p-8 text-center text-zinc-500">
          Cargando‚Ä¶
        </div>
      </div>
    </div>
  </div>

  <!-- Vista LISTA -->
  <div *ngIf="view()==='list'" class="rounded-lg border border-zinc-200 bg-white overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-zinc-50">
        <tr class="text-left">
          <th class="p-3">Nombre</th>
          <th class="p-3">Correo</th>
          <th class="p-3">Tel√©fono</th>
          <th class="p-3 w-44"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of filtered()" class="border-t">
          <td class="p-3 font-medium">{{ c.nombre }}</td>
          <td class="p-3">{{ c.email }}</td>
          <td class="p-3">{{ c.telefono }}</td>
          <td class="p-3 text-right">
            <button class="btn-outline mr-2" (click)="openEdit(c)">Editar</button>
            <button class="btn-danger" (click)="remove(c)">Eliminar</button>
          </td>
        </tr>

        <tr *ngIf="!loading() && filtered().length === 0">
          <td class="p-6 text-center text-zinc-500" colspan="4">Sin resultados</td>
        </tr>
        <tr *ngIf="loading()">
          <td class="p-6 text-center text-zinc-500" colspan="4">Cargando‚Ä¶</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer: contador -->
  <div class="mt-4 text-sm text-zinc-600">
    Mostrando {{ totalMostrados() }} contacto(s)
  </div>

  <!-- Modal crear/editar -->
  <div
    *ngIf="showForm()"
    class="fixed inset-0 z-50 grid place-items-center bg-black/40 p-4"
    data-overlay="true"
    (click)="onOverlayClick($event)"
  >
    <div
      class="w-full max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="px-6 py-5 border-b">
        <h2 class="text-xl font-semibold">
          {{ editingId() ? 'Editar contacto' : 'Nuevo contacto' }}
        </h2>
      </div>

      <!-- Body (scrolleable) -->
      <div class="max-h-[70vh] overflow-y-auto px-6 py-5">
        <form class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-1">
            <label class="block text-xs mb-1">Nombre</label>
            <input class="input w-full" [(ngModel)]="f.nombre" name="nombre" required />
          </div>
          <div class="md:col-span-1">
            <label class="block text-xs mb-1">Correo</label>
            <input class="input w-full" type="email" [(ngModel)]="f.email" name="email" required />
          </div>

          <div class="md:col-span-1">
            <label class="block text-xs mb-1">Tel√©fono</label>
            <input class="input w-full" [(ngModel)]="f.telefono" name="telefono" />
          </div>

          <!-- Spacer para mantener la grilla pareja -->
          <div class="md:col-span-1"></div>
        </form>
      </div>

      <!-- Footer sticky -->
      <div class="sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-2">
        <button type="button" class="btn-outline bg-zinc-50" (click)="cancelForm()">Cancelar</button>
        <button class="btn bg-[var(--accent-600)] text-white" (click)="submit()" [disabled]="loading()">
          {{ loading() ? 'Guardando‚Ä¶' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>
</div>
